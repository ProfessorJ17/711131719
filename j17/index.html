<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Iframe Access</title>
    <script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-firestore.js"></script>
    <style>
        body { background-color: black; color: white; text-align: center; }
        #iframe-container { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; }
        iframe { width: 100%; height: 100%; border: none; }
    </style>
</head>
<body>
    <h1>Login to Access Content</h1>
    <div id="login-form">
        <input type="email" id="email" placeholder="Email"><br>
        <input type="password" id="password" placeholder="Password"><br>
        <button onclick="login()">Login</button>
    </div>
    
    <div id="iframe-container">
        <iframe id="restricted-iframe" src="https://www.youtube.com/embed/dQw4w9WgXcQ"></iframe>
    </div>
    
    <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1;">
        <iframe id="youtube-iframe" width="100%" height="100%" style="border: none;"></iframe>
    </div>
    
    <div id="character-container" style="position: fixed; bottom: 0; right: 0; z-index: 2;"></div>

    <script>
        function loadDIDAgent(container) {
            if (!container.querySelector('script')) {
                const script = document.createElement('script');
                script.type = 'module';
                script.src = 'https://agent.d-id.com/v1/index.js';
                script.setAttribute('data-name', 'did-agent');
                script.setAttribute('data-mode', 'fabio');
                script.setAttribute('data-client-key', 'Z29vZ2xlLW9hdXRoMnwxMDI1NDc5NDg2ODI5NjkwNzc4MDg6RkpFT0VWOTBqYVFVb3lHT3hMU2Zt');
                script.setAttribute('data-agent-id', 'agt_k9HerVqC');
                script.setAttribute('data-monitor', 'true');
                container.appendChild(script);
                console.log('D-ID Agent script loaded');
                script.onload = () => console.log('D-ID Agent script fully loaded');
            }
        }

        const firebaseConfig = {
            apiKey: "AIzaSyDpIapJzv54LIApO_yM2f-SrwkXbjjLRPo",
            authDomain: "ever4-e1efb.firebaseapp.com",
            projectId: "ever4-e1efb",
            storageBucket: "ever4-e1efb.appspot.com",
            messagingSenderId: "473102358637",
            appId: "1:473102358637:web:a28114096fac995e640764"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            auth.signInWithEmailAndPassword(email, password)
                .then(user => checkAccess(user.user.uid))
                .catch(error => alert(error.message));
        }
        
        function checkAccess(uid) {
            const userRef = db.collection("users").doc(uid);
            userRef.get().then(doc => {
                const lastAccess = doc.exists ? doc.data().lastAccess : 0;
                const now = Date.now();
                const oneDay = 24 * 60 * 60 * 1000;
                
                if (!doc.exists || now - lastAccess > oneDay) {
                    userRef.set({ lastAccess: now });
                    grantAccess();
                } else {
                    alert("You can only access this once per 24 hours!");
                }
            });
        }
        
        function grantAccess() {
            document.getElementById("iframe-container").style.display = "block";
            setTimeout(() => {
                document.getElementById("iframe-container").style.display = "none";
                alert("Time's up! Come back tomorrow.");
            }, 5 * 60 * 1000);
        }
    </script>
    
    <script 
        type="module"
        src="https://agent.d-id.com/v1/index.js"
        data-name="did-agent"
        data-mode="fabio"
        data-client-key="Z29vZ2xlLW9hdXRoMnwxMDI1NDc5NDg2ODI5NjkwNzc4MDg6RkpFT0VWOTBqYVFVb3lHT3hMU2Zt"
        data-agent-id="agt_k9HerVqC"
        data-monitor="true">
    </script>
</body>
</html>
